# Facebook Mass Reporting Web UI

This tool provides a web interface to automate the reporting of Facebook posts, pages, or profiles using multiple Facebook accounts. It leverages Selenium for browser automation.

## Features

-   **Web UI for Reporting:** Submit reports via a user-friendly web form.
-   **Multi-Account Reporting:** Rotates through a list of pre-configured Facebook accounts to submit reports.
-   **Evidence Upload:** Supports attaching multiple evidence files (screenshots) to reports.
-   **Report History:** View the status and details of submitted reports.
-   **Dockerized:** Easy setup and deployment using Docker and Docker Compose.
-   **Secure Secret Management:** Utilizes Fernet encryption for sensitive configurations stored in the database.
-   **Cypress Tested:** Includes UI tests for key functionalities.

## Setup and Configuration

The application is designed to be run using Docker Compose.

### 1. Prerequisites

-   Docker and Docker Compose installed.

### 2. Environment Variables

Create a `.env` file in the `tools/web-ui/` directory with the following content. Replace placeholder values with your actual secrets.

```env
# For Flask application security (e.g., session signing)
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
FLASK_SECRET_KEY=your_strong_flask_secret_key_here

# Master encryption key for secrets stored in the database (like FLASK_SECRET_KEY itself if generated by app)
# CRITICAL: This key MUST be set and be persistent across restarts.
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
SETUP_SECRET_KEY=your_strong_fernet_encryption_key_here

# Optional: Configure application log level (e.g., DEBUG, INFO, WARNING, ERROR)
# LOG_LEVEL=INFO

# Optional: Configure Selenium browser (chrome or firefox)
# SELENIUM_BROWSER=chrome

# Optional: Override default PostgreSQL credentials (defaults are user: postgres, pass: postgres, db: postgres)
# POSTGRES_USER=your_db_user
# POSTGRES_PASSWORD=your_db_password
# POSTGRES_DB=your_db_name
```

**Important Notes on Environment Variables:**
-   `FLASK_SECRET_KEY` is used by Flask for session management and other security features.
-   `SETUP_SECRET_KEY` is the master key used by Fernet to encrypt other secrets (including `FLASK_SECRET_KEY` if it's initially generated by the app and stored in the database). **If this key is lost or changed, previously encrypted secrets in the database will become unreadable.** Ensure it's backed up and kept secure.

### 3. Facebook Accounts Configuration

You need to provide the Facebook accounts that will be used for reporting. There are two ways:

**Option A (Recommended for Security): Environment Variable `FB_ACCOUNTS_JSON`**

Set an environment variable `FB_ACCOUNTS_JSON` with the JSON array of accounts. This is more secure as credentials are not stored in a plaintext file on disk.

Example for your `.env` file or shell environment:
```env
FB_ACCOUNTS_JSON='[{"email": "fb_account1@example.com", "password": "password1"}, {"email": "fb_account2@example.com", "password": "password2"}]'
```
Make sure the JSON is valid and correctly quoted if setting in a `.env` file.

**Option B: `fb_accounts.json` File**

Create a file named `fb_accounts.json` in the `tools/web-ui/` directory.

```json
[
  { "email": "fb_account1@example.com", "password": "password1" },
  { "email": "fb_account2@example.com", "password": "password2" }
]
```

**Security Warning:** Storing passwords in plaintext in `fb_accounts.json` is a security risk. If you use this method, ensure you restrict file permissions (e.g., `chmod 600 fb_accounts.json`) so that only the owner can read it. The application prioritizes the `FB_ACCOUNTS_JSON` environment variable if both are present.

### 4. Build and Run with Docker Compose

Navigate to the `tools/web-ui/` directory in your terminal and run:

```bash
docker compose up --build -d
```

This will:
-   Build the `backend` Docker image.
-   Start three services: `backend` (Flask app on port 5050), `db` (PostgreSQL), and `frontend` (Nginx serving the UI on port 3000).

### 5. Access the Application

Open your web browser and navigate to:
[http://localhost:3000](http://localhost:3000)

You should see the Facebook Mass Reporter interface.

## Using the Tool

1.  **Navigate to the UI:** Open [http://localhost:3000](http://localhost:3000).
2.  **Submit a Report:**
    *   Fill in the "Target URL" of the Facebook content you want to report.
    *   Provide a "Justification" for the report.
    *   Optionally, upload one or more "Evidence Files".
    *   Click "Submit Report".
3.  **View Status:** The submission status will appear below the form, indicating success or failure for each reporting account used.
4.  **Check History:** The "Report History" section will update to show all submitted reports and their status.

## API Endpoints

While the primary interaction is via the Web UI, the backend exposes these key API endpoints:

-   `POST /api/report`: Submits a new report. Expects `multipart/form-data` with `target_url`, `justification`, and optional `evidence` files.
-   `GET /api/reports`: Lists all previously submitted reports.
-   `GET /api/report/<int:report_id>`: Retrieves details of a specific report.
-   `GET /api/evidence/<filename>`: Serves an uploaded evidence file.
-   `POST /api/setup-secrets`: (For initial setup) Generates and stores various predefined secrets in the database, encrypted with `SETUP_SECRET_KEY`.
-   `POST /api/rotate-flask-secret`: Rotates the `FLASK_SECRET_KEY` stored in the database.

## Running Cypress Tests

Cypress tests are included to verify the UI functionality.

### Prerequisites for Cypress:
- Node.js and npm/yarn installed if running locally outside Docker.
- The application services (`backend`, `db`, `frontend`) must be running.

### Option 1: Using Docker Compose (Recommended)
The `build/docker-compose.yml` file provides a way to execute commands in the `frontend` service context. However, the default `nginx:alpine` image doesn't include Cypress or Node.js. For a fully containerized test run, you might need a dedicated Cypress service or run tests from your host machine against the running application.

A more common approach if your host has Node.js/Cypress:
1. Ensure the application is running: `cd tools/web-ui && docker compose up -d`
2. Navigate to the `tools/web-ui/` directory on your host.
3. Install Cypress dev dependencies if you haven't: `npm install cypress --save-dev` (or `yarn add cypress --dev`) if a `package.json` for dev tools is set up in this directory. Or install Cypress globally/project-wide.
4. Open Cypress Test Runner: `npx cypress open`
5. Run tests headlessly: `npx cypress run --headless --browser chrome`

The Cypress tests use `cypress/fixtures/sample_evidence.png` for file upload tests.

### Option 2: (If `frontend` service had Cypress tools)
```bash
# (From project root)
# cd tools/web-ui
docker compose exec frontend npx cypress run --headless --browser chrome
```
*(This command assumes the `frontend` service's image is equipped with Cypress and a browser, which `nginx:alpine` is not. Adjust if you have a custom Cypress test runner service).*

## Technical Details & Notes

-   **Backend:** Flask (Python) with Gunicorn.
-   **Frontend:** Served by Nginx, using HTML, CSS, and vanilla JavaScript.
-   **Database:** PostgreSQL (for report history and encrypted secrets).
-   **Facebook Automation:** Uses Selenium with Chrome (default) or Firefox (configurable via `SELENIUM_BROWSER` env var) for interacting with Facebook.
-   **Evidence Storage:** Uploaded evidence files are temporarily stored in `/tmp/fb_evidence_uploads` *inside the backend container*. This storage is ephemeral and will be lost if the container is removed or restarted without a persistent volume for this path. For persistent evidence, manual adjustments to `docker-compose.yml` to mount a volume to this path would be needed.
-   **Selenium Stability:** The success of Facebook reporting heavily depends on Facebook's UI structure remaining consistent. Changes by Facebook can break the Selenium automation scripts.
-   **Security:**
    -   Always use strong, unique passwords for `SETUP_SECRET_KEY` and `FLASK_SECRET_KEY`.
    -   Be cautious with `fb_accounts.json` if used; prefer the `FB_ACCOUNTS_JSON` environment variable.
    -   The default PostgreSQL credentials (`postgres:postgres`) in `docker-compose.yml` are for development convenience and should be changed for any sensitive deployment.

## Troubleshooting

-   **Report Submission Fails:**
    *   Check the logs of the `backend` container: `docker compose logs backend`.
    *   Ensure your Facebook accounts in `fb_accounts.json` or `FB_ACCOUNTS_JSON` are valid and not locked/disabled.
    *   Facebook might have updated its UI, or be presenting CAPTCHAs or other challenges.
-   **Secrets Not Working After Restart:** Ensure `SETUP_SECRET_KEY` environment variable is correctly set and **remains the same** across restarts. If it changes, previously encrypted data in the database will be unreadable.
-   **Port Conflicts:** Ensure ports `3000` (frontend UI) and `5050` (backend API) are free on your host machine.
```
